<?php
// Підключення до бази даних
include 'core_logic/DBConnect.php';
session_start(); // Початок сесії

// Перевірка, чи користувач авторизований
if (isset($_SESSION['user_id'])) {

    // Перевірка, чи передано валідне ID для видалення
    if (isset($_GET['ID']) && is_numeric($_GET['ID'])) {
        $userId = $_GET['ID'];

        // Перевірка, чи це ID поточного користувача
        if ($userId == $_SESSION['user_id']) {

            // Підготовка запиту на видалення користувача з таблиці users
            $stmt = $conn->prepare("DELETE FROM users WHERE ID = ?");
            if (!$stmt) {
                die("Помилка підготовки запиту: " . $conn->error); // Перевірка помилок підготовки запиту
            }
            $stmt->bind_param("i", $userId);

            // Виконання запиту
            if ($stmt->execute()) {
                // Якщо видалення успішне
                echo "Ваш акаунт успішно видалено.";
                
                // Закриття сесії після видалення
                session_destroy();

                // Перенаправлення на головну сторінку після видалення
                header("Location: index.php");
                exit();
            } else {
                // Якщо сталася помилка при видаленні
                echo "Помилка при видаленні акаунта: " . $stmt->error;
                exit();
            }

            // Закриття підготовленого запиту
            $stmt->close();
        } else {
            // Якщо користувач намагається видалити іншого користувача
            echo "Ви не можете видалити акаунт іншого користувача.";
        }
    } else {
        // Якщо ID не передано або він некоректний
        echo "Невірний ID для видалення.";
    }
} else {
    // Якщо користувач не авторизований, перенаправляємо на сторінку прощання
    header("Location: goodbye.php"); // Ви можете створити сторінку goodbye.php для прощання
    exit();
}
?>
